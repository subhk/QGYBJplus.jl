<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Wave-Mean Interaction · QGYBJ+.jl</title><meta name="title" content="Wave-Mean Interaction · QGYBJ+.jl"/><meta property="og:title" content="Wave-Mean Interaction · QGYBJ+.jl"/><meta property="twitter:title" content="Wave-Mean Interaction · QGYBJ+.jl"/><meta name="description" content="Documentation for QGYBJ+.jl."/><meta property="og:description" content="Documentation for QGYBJ+.jl."/><meta property="twitter:description" content="Documentation for QGYBJ+.jl."/><meta property="og:url" content="https://subhk.github.io/QGYBJplus.jl/stable/physics/wave_mean/"/><meta property="twitter:url" content="https://subhk.github.io/QGYBJplus.jl/stable/physics/wave_mean/"/><link rel="canonical" href="https://subhk.github.io/QGYBJplus.jl/stable/physics/wave_mean/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">QGYBJ+.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../getting_started/">Installation</a></li><li><a class="tocitem" href="../../quickstart/">Quick Start</a></li><li><a class="tocitem" href="../../worked_example/">Worked Example</a></li></ul></li><li><span class="tocitem">Physics &amp; Theory</span><ul><li><a class="tocitem" href="../overview/">Model Overview</a></li><li><a class="tocitem" href="../qg_equations/">QG Equations</a></li><li><a class="tocitem" href="../ybj_plus/">YBJ+ Wave Model</a></li><li class="is-active"><a class="tocitem" href>Wave-Mean Interaction</a><ul class="internal"><li><a class="tocitem" href="#Physical-Motivation"><span>Physical Motivation</span></a></li><li><a class="tocitem" href="#The-Wave-Feedback-Term"><span>The Wave Feedback Term</span></a></li><li><a class="tocitem" href="#Energy-Exchange"><span>Energy Exchange</span></a></li><li><a class="tocitem" href="#Refraction-Mechanism"><span>Refraction Mechanism</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Scaling-Analysis"><span>Scaling Analysis</span></a></li><li><a class="tocitem" href="#Coupled-Dynamics"><span>Coupled Dynamics</span></a></li><li><a class="tocitem" href="#Diagnostics"><span>Diagnostics</span></a></li><li><a class="tocitem" href="#Complete-Energy-Budget"><span>Complete Energy Budget</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../numerical_methods/">Numerical Methods</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../../guide/configuration/">Configuration</a></li><li><a class="tocitem" href="../../guide/stratification/">Stratification</a></li><li><a class="tocitem" href="../../guide/initial_conditions/">Initial Conditions</a></li><li><a class="tocitem" href="../../guide/simulation/">Running Simulations</a></li><li><a class="tocitem" href="../../guide/io/">I/O and Output</a></li><li><a class="tocitem" href="../../guide/diagnostics/">Diagnostics</a></li></ul></li><li><span class="tocitem">Advanced Topics</span><ul><li><a class="tocitem" href="../../advanced/parallel/">MPI Parallelization</a></li><li><a class="tocitem" href="../../advanced/particles/">Particle Advection</a></li><li><a class="tocitem" href="../../advanced/parallel_particles/">Parallel Particle Algorithm</a></li><li><a class="tocitem" href="../../advanced/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../advanced/performance/">Performance Tips</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/types/">Core Types</a></li><li><a class="tocitem" href="../../api/grid_state/">Grid &amp; State</a></li><li><a class="tocitem" href="../../api/physics/">Physics Functions</a></li><li><a class="tocitem" href="../../api/timestepping/">Time Stepping</a></li><li><a class="tocitem" href="../../api/particles/">Particles</a></li><li><a class="tocitem" href="../../api/">Full Index</a></li></ul></li><li><a class="tocitem" href="../../troubleshooting/">Troubleshooting</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Physics &amp; Theory</a></li><li class="is-active"><a href>Wave-Mean Interaction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Wave-Mean Interaction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/QGYBJplus.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/subhk/QGYBJplus.jl/blob/main/docs/src/physics/wave_mean.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="wave-mean"><a class="docs-heading-anchor" href="#wave-mean">Wave-Mean Interaction</a><a id="wave-mean-1"></a><a class="docs-heading-anchor-permalink" href="#wave-mean" title="Permalink"></a></h1><p>This page describes the two-way coupling between near-inertial waves and the balanced mean flow.</p><h2 id="Physical-Motivation"><a class="docs-heading-anchor" href="#Physical-Motivation">Physical Motivation</a><a id="Physical-Motivation-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Motivation" title="Permalink"></a></h2><h3 id="Why-Waves-Affect-the-Mean-Flow"><a class="docs-heading-anchor" href="#Why-Waves-Affect-the-Mean-Flow">Why Waves Affect the Mean Flow</a><a id="Why-Waves-Affect-the-Mean-Flow-1"></a><a class="docs-heading-anchor-permalink" href="#Why-Waves-Affect-the-Mean-Flow" title="Permalink"></a></h3><p>Near-inertial waves carry momentum and energy. When they:</p><ul><li><strong>Break</strong> or dissipate</li><li><strong>Refract</strong> through vorticity gradients</li><li><strong>Interact nonlinearly</strong> with the flow</li></ul><p>...they can transfer energy and momentum to the balanced circulation.</p><h3 id="Observational-Evidence"><a class="docs-heading-anchor" href="#Observational-Evidence">Observational Evidence</a><a id="Observational-Evidence-1"></a><a class="docs-heading-anchor-permalink" href="#Observational-Evidence" title="Permalink"></a></h3><ul><li>Anticyclones contain <strong>enhanced</strong> NIW energy (chimney effect)</li><li>Wave dissipation correlates with <strong>mixing</strong> in anticyclones</li><li>Waves can <strong>energize</strong> the mesoscale eddy field</li></ul><h2 id="The-Wave-Feedback-Term"><a class="docs-heading-anchor" href="#The-Wave-Feedback-Term">The Wave Feedback Term</a><a id="The-Wave-Feedback-Term-1"></a><a class="docs-heading-anchor-permalink" href="#The-Wave-Feedback-Term" title="Permalink"></a></h2><h3 id="Definition"><a class="docs-heading-anchor" href="#Definition">Definition</a><a id="Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Definition" title="Permalink"></a></h3><p>Following Xie &amp; Vanneste (2015), the wave-induced potential vorticity is:</p><p class="math-container">\[q^w = \frac{i}{2} J(B^*, B) + \frac{1}{4} \nabla_h^2 |B|^2\]</p><p>where <span>$B$</span> is the complex wave envelope with units of velocity (m/s).</p><div class="admonition is-info" id="Dimensional-Equations-773fc28c73b6e00d"><header class="admonition-header">Dimensional Equations<a class="admonition-anchor" href="#Dimensional-Equations-773fc28c73b6e00d" title="Permalink"></a></header><div class="admonition-body"><p>The model solves dimensional equations where <span>$B$</span> has actual velocity amplitude. No additional scaling factors (like W2F) are needed.</p></div></div><h3 id="Decomposition-in-Real/Imaginary-Parts"><a class="docs-heading-anchor" href="#Decomposition-in-Real/Imaginary-Parts">Decomposition in Real/Imaginary Parts</a><a id="Decomposition-in-Real/Imaginary-Parts-1"></a><a class="docs-heading-anchor-permalink" href="#Decomposition-in-Real/Imaginary-Parts" title="Permalink"></a></h3><p>Writing <span>$B = B_R + i B_I$</span>, the Jacobian term becomes:</p><p class="math-container">\[\frac{i}{2} J(B^*, B) = \frac{\partial B_R}{\partial y} \frac{\partial B_I}{\partial x} - \frac{\partial B_R}{\partial x} \frac{\partial B_I}{\partial y}\]</p><p>And the wave intensity:</p><p class="math-container">\[|B|^2 = B_R^2 + B_I^2\]</p><p>So the complete formula in spectral space is:</p><p class="math-container">\[q^w = \left( \frac{\partial B_R}{\partial y} \frac{\partial B_I}{\partial x} - \frac{\partial B_R}{\partial x} \frac{\partial B_I}{\partial y} \right) - \frac{k_h^2}{4} (B_R^2 + B_I^2)\]</p><p>Note: In spectral space, <span>$\nabla_h^2 \to -k_h^2$</span>, so <span>$+\frac{1}{4}\nabla_h^2|B|^2 \to -\frac{k_h^2}{4}|B|^2$</span>.</p><h3 id="How-It-Enters-the-QG-Equation"><a class="docs-heading-anchor" href="#How-It-Enters-the-QG-Equation">How It Enters the QG Equation</a><a id="How-It-Enters-the-QG-Equation-1"></a><a class="docs-heading-anchor-permalink" href="#How-It-Enters-the-QG-Equation" title="Permalink"></a></h3><p>The wave feedback modifies the effective PV used for streamfunction inversion:</p><p class="math-container">\[q^* = q - q^w\]</p><p>Then <span>$\psi$</span> is computed from <span>$q^*$</span> via the elliptic inversion:</p><p class="math-container">\[\nabla^2\psi + \frac{\partial}{\partial z}\left(\frac{f_0^2}{N^2}\frac{\partial\psi}{\partial z}\right) = q^*\]</p><h3 id="Physical-Interpretation"><a class="docs-heading-anchor" href="#Physical-Interpretation">Physical Interpretation</a><a id="Physical-Interpretation-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Interpretation" title="Permalink"></a></h3><table><tr><th style="text-align: left">Term</th><th style="text-align: left">Meaning</th></tr><tr><td style="text-align: left"><span>$J(B^*, B)$</span></td><td style="text-align: left">Jacobian of complex wave field (wave momentum flux)</td></tr><tr><td style="text-align: left"><span>$\nabla_h^2|B|^2$</span></td><td style="text-align: left">Horizontal curvature of wave energy density</td></tr></table><p>The wave feedback represents:</p><ul><li><strong>Radiation stress</strong> from wave momentum flux</li><li><strong>Form drag</strong> from wave-induced pressure fluctuations</li></ul><h2 id="Energy-Exchange"><a class="docs-heading-anchor" href="#Energy-Exchange">Energy Exchange</a><a id="Energy-Exchange-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Exchange" title="Permalink"></a></h2><h3 id="Wave-to-Flow-Transfer"><a class="docs-heading-anchor" href="#Wave-to-Flow-Transfer">Wave-to-Flow Transfer</a><a id="Wave-to-Flow-Transfer-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-to-Flow-Transfer" title="Permalink"></a></h3><p>Energy flows from waves to mean flow when:</p><p class="math-container">\[\mathcal{E}_{w \to f} = -\int \psi \cdot J(\psi, q^w) \, dV\]</p><p>This can be positive or negative:</p><ul><li><strong>Positive</strong>: Waves energize the flow</li><li><strong>Negative</strong>: Flow energizes waves (less common)</li></ul><h3 id="Conservation"><a class="docs-heading-anchor" href="#Conservation">Conservation</a><a id="Conservation-1"></a><a class="docs-heading-anchor-permalink" href="#Conservation" title="Permalink"></a></h3><p>In the inviscid limit, total energy is conserved:</p><p class="math-container">\[\frac{d}{dt}(E_{flow} + E_{wave}) = 0\]</p><p>The wave feedback term merely <strong>redistributes</strong> energy.</p><h2 id="Refraction-Mechanism"><a class="docs-heading-anchor" href="#Refraction-Mechanism">Refraction Mechanism</a><a id="Refraction-Mechanism-1"></a><a class="docs-heading-anchor-permalink" href="#Refraction-Mechanism" title="Permalink"></a></h2><h3 id="How-Eddies-Focus-Waves"><a class="docs-heading-anchor" href="#How-Eddies-Focus-Waves">How Eddies Focus Waves</a><a id="How-Eddies-Focus-Waves-1"></a><a class="docs-heading-anchor-permalink" href="#How-Eddies-Focus-Waves" title="Permalink"></a></h3><p>Anticyclones (negative vorticity) trap waves:</p><ol><li><strong>Effective frequency</strong> is reduced: <span>$f_{eff} = f_0 + \zeta/2$</span></li><li>Waves propagate toward <strong>lower</strong> effective frequency</li><li>Energy <strong>accumulates</strong> in anticyclone cores</li></ol><h3 id="The-Chimney-Effect"><a class="docs-heading-anchor" href="#The-Chimney-Effect">The Chimney Effect</a><a id="The-Chimney-Effect-1"></a><a class="docs-heading-anchor-permalink" href="#The-Chimney-Effect" title="Permalink"></a></h3><pre><code class="nohighlight hljs">         Wind Forcing
              ↓
    ┌─────────────────────┐
    │   Surface Layer     │
    └─────────┬───────────┘
              │
    ┌─────────┼───────────┐
    │    ↙    ↓    ↘      │  ← Waves spread horizontally
    │   ↙     ↓     ↘     │
    └──↙──────┼──────↘────┘
       ↘      ↓      ↙
        ↘     ↓     ↙
         ↘    ↓    ↙        ← Anticyclone focuses waves
    ┌─────────┼───────────┐
    │         ↓           │
    │    Anticyclone      │  ← Enhanced dissipation
    │      (ζ &lt; 0)        │
    └─────────────────────┘</code></pre><p>Waves are funneled into anticyclones, enhancing deep mixing.</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><h3 id="Computing-Wave-Feedback"><a class="docs-heading-anchor" href="#Computing-Wave-Feedback">Computing Wave Feedback</a><a id="Computing-Wave-Feedback-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Wave-Feedback" title="Permalink"></a></h3><pre><code class="language-julia hljs"># In nonlinear.jl: compute_qw! (BR/BI form)
function compute_qw!(qwk, BRk, BIk, par, G, plans; Lmask=nothing)
    # 1. Compute derivatives of BR and BI
    # BRx = ∂BR/∂x, BRy = ∂BR/∂y, etc.
    BRxk = im * kx .* BRk
    BRyk = im * ky .* BRk
    BIxk = im * kx .* BIk
    BIyk = im * ky .* BIk

    # 2. Transform to real space
    # ...

    # 3. Compute Jacobian term: BRy*BIx - BRx*BIy
    qwr = BRyr .* BIxr - BRxr .* BIyr

    # 4. Compute |B|² = BR² + BI²
    mag2 = BRr.^2 + BIr.^2

    # 5. Assemble in spectral space
    # qw = J_term - (1/4)*kh²*|B|²  (note: ∇² → -kh² in spectral)
    qwk = (fft(qwr) - 0.25 * kh2 .* fft(mag2)) / norm

    # Note: No additional scaling needed - B has dimensional velocity units (m/s)
end</code></pre><p>For the complex envelope form used in YBJ+ time stepping, use:</p><pre><code class="language-julia hljs">compute_qw_complex!(qwk, Bk, par, G, plans; Lmask=L)</code></pre><h3 id="Usage-in-Time-Stepping"><a class="docs-heading-anchor" href="#Usage-in-Time-Stepping">Usage in Time Stepping</a><a id="Usage-in-Time-Stepping-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-in-Time-Stepping" title="Permalink"></a></h3><p>The wave feedback enters via q* = q - qw:</p><pre><code class="language-julia hljs"># After computing q at new time step
if wave_feedback_enabled
    compute_qw!(qwk, BRk, BIk, par, G, plans; Lmask=L)
    q_arr .-= qwk_arr  # q* = q - qw
end

# Complex B form (YBJ+ path)
if wave_feedback_enabled
    compute_qw_complex!(qwk, Bk, par, G, plans; Lmask=L)
    q_arr .-= qwk_arr  # q* = q - qw
end

# Then invert q* to get ψ
invert_q_to_psi!(state, grid; a=a_vec)</code></pre><h3 id="Enabling/Disabling"><a class="docs-heading-anchor" href="#Enabling/Disabling">Enabling/Disabling</a><a id="Enabling/Disabling-1"></a><a class="docs-heading-anchor-permalink" href="#Enabling/Disabling" title="Permalink"></a></h3><pre><code class="language-julia hljs"># With wave feedback (default)
params = default_params(Lx=500e3, Ly=500e3, Lz=4000.0; no_feedback=false, no_wave_feedback=false)

# Without wave feedback
params = default_params(Lx=500e3, Ly=500e3, Lz=4000.0; no_feedback=true)
# or
params = default_params(Lx=500e3, Ly=500e3, Lz=4000.0; no_wave_feedback=true)</code></pre><p>Disabling is useful for:</p><ul><li>Studying one-way wave-flow interaction</li><li>Isolating wave dynamics from flow effects</li><li>Computational efficiency when feedback is weak</li></ul><h2 id="Scaling-Analysis"><a class="docs-heading-anchor" href="#Scaling-Analysis">Scaling Analysis</a><a id="Scaling-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Scaling-Analysis" title="Permalink"></a></h2><h3 id="When-is-Feedback-Important?"><a class="docs-heading-anchor" href="#When-is-Feedback-Important?">When is Feedback Important?</a><a id="When-is-Feedback-Important?-1"></a><a class="docs-heading-anchor-permalink" href="#When-is-Feedback-Important?" title="Permalink"></a></h3><p>The feedback strength scales as:</p><p class="math-container">\[\frac{|q^w|}{|q|} \sim \left(\frac{A_0}{U}\right)^2 \cdot \left(\frac{L_w}{L}\right)^2\]</p><p>where:</p><ul><li><span>$A_0/U$</span>: Wave-to-flow velocity ratio</li><li><span>$L_w/L$</span>: Wave-to-eddy length ratio</li></ul><p>Feedback matters when:</p><ul><li>Strong wind forcing (large <span>$A_0$</span>)</li><li>Compact wave packets (small <span>$L_w$</span>)</li><li>Weak background flow (small <span>$U$</span>)</li></ul><h3 id="Typical-Values"><a class="docs-heading-anchor" href="#Typical-Values">Typical Values</a><a id="Typical-Values-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-Values" title="Permalink"></a></h3><table><tr><th style="text-align: left">Scenario</th><th style="text-align: left">Wave Feedback</th></tr><tr><td style="text-align: left">Weak winds, strong eddies</td><td style="text-align: left">Negligible</td></tr><tr><td style="text-align: left">Storm forcing</td><td style="text-align: left">Moderate (1-10%)</td></tr><tr><td style="text-align: left">Tropical cyclone</td><td style="text-align: left">Strong (10-50%)</td></tr></table><h2 id="Coupled-Dynamics"><a class="docs-heading-anchor" href="#Coupled-Dynamics">Coupled Dynamics</a><a id="Coupled-Dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Coupled-Dynamics" title="Permalink"></a></h2><h3 id="Feedback-Loop"><a class="docs-heading-anchor" href="#Feedback-Loop">Feedback Loop</a><a id="Feedback-Loop-1"></a><a class="docs-heading-anchor-permalink" href="#Feedback-Loop" title="Permalink"></a></h3><pre><code class="nohighlight hljs">┌──────────────┐         ┌──────────────┐
│              │         │              │
│   Eddies     │◄────────│    Waves     │
│   (ψ, q)     │         │   (A, B)     │
│              │         │              │
└──────┬───────┘         └──────┬───────┘
       │                        │
       │ Refraction             │ Feedback
       │ ∂ζ/∂t                  │ qw
       │                        │
       ▼                        ▼
┌──────────────────────────────────────┐
│                                      │
│       Wave-Mean Energy Exchange      │
│                                      │
└──────────────────────────────────────┘</code></pre><h3 id="Equilibration"><a class="docs-heading-anchor" href="#Equilibration">Equilibration</a><a id="Equilibration-1"></a><a class="docs-heading-anchor-permalink" href="#Equilibration" title="Permalink"></a></h3><p>The coupled system can reach statistical equilibrium where:</p><ul><li>Wave generation (wind) balances dissipation</li><li>Energy flux from waves to flow balances eddy dissipation</li><li>Net energy is constant on average</li></ul><h2 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h2><h3 id="Monitoring-Energy-Exchange"><a class="docs-heading-anchor" href="#Monitoring-Energy-Exchange">Monitoring Energy Exchange</a><a id="Monitoring-Energy-Exchange-1"></a><a class="docs-heading-anchor-permalink" href="#Monitoring-Energy-Exchange" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Compute wave feedback contribution
qw = compute_wave_pv(state.A, grid)

# Energy exchange rate
exchange_rate = compute_energy_exchange(state.psi, qw, grid, plans)</code></pre><h3 id="Typical-Analysis"><a class="docs-heading-anchor" href="#Typical-Analysis">Typical Analysis</a><a id="Typical-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-Analysis" title="Permalink"></a></h3><ol><li>Track <span>$E_{flow}$</span> and <span>$E_{wave}$</span> over time</li><li>Compute their time derivatives</li><li>Compare with wave feedback term to verify energy conservation</li></ol><h2 id="Complete-Energy-Budget"><a class="docs-heading-anchor" href="#Complete-Energy-Budget">Complete Energy Budget</a><a id="Complete-Energy-Budget-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-Energy-Budget" title="Permalink"></a></h2><h3 id="Energy-Components"><a class="docs-heading-anchor" href="#Energy-Components">Energy Components</a><a id="Energy-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Components" title="Permalink"></a></h3><p>The total energy of the QG-YBJ+ system consists of five components:</p><p class="math-container">\[E_{total} = \underbrace{E_{KE}^{flow} + E_{PE}^{flow}}_{\text{Mean flow energy}} + \underbrace{E_{KE}^{wave} + E_{PE}^{wave} + E_{CE}^{wave}}_{\text{Wave energy}}\]</p><h4 id="Mean-Flow-Kinetic-Energy"><a class="docs-heading-anchor" href="#Mean-Flow-Kinetic-Energy">Mean Flow Kinetic Energy</a><a id="Mean-Flow-Kinetic-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Mean-Flow-Kinetic-Energy" title="Permalink"></a></h4><p class="math-container">\[E_{KE}^{flow} = \frac{1}{2} \int \int \int (u^2 + v^2) \, dx\, dy\, dz\]</p><p>In spectral space with dealiasing:</p><p class="math-container">\[E_{KE}^{flow} = \frac{1}{2} \sum_{k_x, k_y, z} L(k_x, k_y) \cdot k_h^2 |\hat{\psi}|^2 - \frac{1}{2}|\hat{\psi}(k_h=0)|^2\]</p><p>where <span>$L(k_x, k_y)$</span> is the dealiasing mask (2/3 rule) and the second term corrects for the zero-wavenumber mode.</p><h4 id="Mean-Flow-Potential-Energy"><a class="docs-heading-anchor" href="#Mean-Flow-Potential-Energy">Mean Flow Potential Energy</a><a id="Mean-Flow-Potential-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Mean-Flow-Potential-Energy" title="Permalink"></a></h4><p class="math-container">\[E_{PE}^{flow} = \frac{1}{2} \int \int \int \frac{f_0^2}{N^2} \left(\frac{\partial \psi}{\partial z}\right)^2 dx\, dy\, dz\]</p><p>In spectral space:</p><p class="math-container">\[E_{PE}^{flow} = \frac{1}{2} \sum_{k_x, k_y, z} \frac{f_0^2}{N^2(z)} |\hat{b}|^2\]</p><p>where <span>$b = \partial\psi/\partial z$</span> is the buoyancy from thermal wind balance.</p><h4 id="Wave-Kinetic-Energy"><a class="docs-heading-anchor" href="#Wave-Kinetic-Energy">Wave Kinetic Energy</a><a id="Wave-Kinetic-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Kinetic-Energy" title="Permalink"></a></h4><p class="math-container">\[E_{KE}^{wave} = \frac{1}{2} \int \int \int |B|^2 \, dx\, dy\, dz\]</p><p>In spectral space with <span>$B = B_R + iB_I$</span>:</p><p class="math-container">\[E_{KE}^{wave} = \frac{1}{2} \sum_{k_x, k_y, z} (|\hat{B}_R|^2 + |\hat{B}_I|^2) - \frac{1}{2}|\hat{B}(k_h=0)|^2\]</p><h4 id="Wave-Potential-Energy"><a class="docs-heading-anchor" href="#Wave-Potential-Energy">Wave Potential Energy</a><a id="Wave-Potential-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Potential-Energy" title="Permalink"></a></h4><p>From the YBJ+ formulation, the wave potential energy involves <span>$C = \partial A/\partial z$</span>:</p><p class="math-container">\[E_{PE}^{wave} = \frac{1}{2} \int \int \int \frac{N^2}{2f_0^2} k_h^2 |C|^2 \, dx\, dy\, dz\]</p><p>In spectral space:</p><p class="math-container">\[E_{PE}^{wave} = \frac{1}{2} \sum_{k_x, k_y, z} \frac{k_h^2}{2 a_{ell}} (|\hat{C}_R|^2 + |\hat{C}_I|^2)\]</p><p>where <span>$a_{ell} = f_0^2/N^2$</span> is the elliptic coefficient.</p><h4 id="Wave-Correction-Energy-(YBJ)"><a class="docs-heading-anchor" href="#Wave-Correction-Energy-(YBJ)">Wave Correction Energy (YBJ+)</a><a id="Wave-Correction-Energy-(YBJ)-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Correction-Energy-(YBJ)" title="Permalink"></a></h4><p>The YBJ+ equation introduces a higher-order correction:</p><p class="math-container">\[E_{CE}^{wave} = \frac{1}{8} \int \int \int \frac{N^4}{f_0^4} k_h^4 |A|^2 \, dx\, dy\, dz\]</p><p>In spectral space:</p><p class="math-container">\[E_{CE}^{wave} = \frac{1}{2} \sum_{k_x, k_y, z} \frac{k_h^4}{8 a_{ell}^2} (|\hat{A}_R|^2 + |\hat{A}_I|^2)\]</p><p>This term accounts for horizontal wave dispersion and becomes significant at small scales.</p><h3 id="Energy-Conservation-Theorem"><a class="docs-heading-anchor" href="#Energy-Conservation-Theorem">Energy Conservation Theorem</a><a id="Energy-Conservation-Theorem-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Conservation-Theorem" title="Permalink"></a></h3><p><strong>Theorem</strong>: In the inviscid limit (no dissipation), the total energy is conserved:</p><p class="math-container">\[\frac{dE_{total}}{dt} = 0\]</p><p><strong>Proof sketch</strong>:</p><ol><li>The QG PV equation conserves mean flow energy in the absence of wave feedback</li><li>The YBJ+ equation conserves wave energy in the absence of mean flow</li><li>The wave feedback term <span>$q^w$</span> transfers energy between waves and flow without dissipation</li><li>The refraction term <span>$\frac{1}{2}B \cdot \zeta$</span> exchanges energy via wave-vorticity interaction</li></ol><h3 id="Energy-Transfer-Pathways"><a class="docs-heading-anchor" href="#Energy-Transfer-Pathways">Energy Transfer Pathways</a><a id="Energy-Transfer-Pathways-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Transfer-Pathways" title="Permalink"></a></h3><pre><code class="nohighlight hljs">                    Wind Forcing
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │           Wave Energy                  │
    │   E_KE^wave + E_PE^wave + E_CE^wave    │
    └────────────────┬───────────────────────┘
                     │
           Refraction │ Wave Feedback
           (B·ζ term) │ (q^w term)
                     │
                     ▼
    ┌────────────────────────────────────────┐
    │         Mean Flow Energy               │
    │        E_KE^flow + E_PE^flow           │
    └────────────────┬───────────────────────┘
                     │
                     ▼
              Viscous Dissipation</code></pre><h3 id="Energy-Exchange-Rate"><a class="docs-heading-anchor" href="#Energy-Exchange-Rate">Energy Exchange Rate</a><a id="Energy-Exchange-Rate-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Exchange-Rate" title="Permalink"></a></h3><p>The rate of energy transfer from waves to mean flow is:</p><p class="math-container">\[\mathcal{P}_{w \to f} = -\int \psi \cdot J(\psi, q^w) \, dV\]</p><p>This can be computed diagnostically:</p><pre><code class="language-julia hljs"># Compute energy exchange rate
qw = compute_qw(state, grid, params, plans)
P_exchange = -sum(psi .* jacobian(psi, qw, grid, plans))</code></pre><h3 id="Energy-Scales"><a class="docs-heading-anchor" href="#Energy-Scales">Energy Scales</a><a id="Energy-Scales-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Scales" title="Permalink"></a></h3><p>Using the characteristic scales:</p><ul><li>Velocity: <span>$U$</span> (mean flow), <span>$U_w$</span> (waves)</li><li>Length: <span>$L$</span> (horizontal), <span>$H$</span> (vertical)</li><li>Time: <span>$1/f_0$</span></li></ul><p>The energy ratio scales as:</p><p class="math-container">\[\frac{E^{wave}}{E^{flow}} \sim \left(\frac{U_w}{U}\right)^2\]</p><p>Typical oceanic values for wave-to-flow energy ratio:</p><ul><li>Gulf Stream region: <span>$\sim 10^{-2}$</span> to <span>$10^{-1}$</span></li><li>Open ocean: <span>$\sim 10^{-3}$</span></li><li>After storm: <span>$\sim 1$</span></li></ul><h3 id="Diagnostic-Implementation"><a class="docs-heading-anchor" href="#Diagnostic-Implementation">Diagnostic Implementation</a><a id="Diagnostic-Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostic-Implementation" title="Permalink"></a></h3><p>Energy diagnostics are automatically saved to separate files:</p><pre><code class="language-julia hljs"># Output files in diagnostic/ folder:
# - wave_KE.nc: E_KE^wave time series
# - wave_PE.nc: E_PE^wave time series
# - wave_CE.nc: E_CE^wave time series
# - mean_flow_KE.nc: E_KE^flow time series
# - mean_flow_PE.nc: E_PE^flow time series
# - total_energy.nc: All energies + totals

# Verify conservation
ds = NCDataset(&quot;output/diagnostic/total_energy.nc&quot;)
E_total = ds[&quot;total_energy&quot;][:]
dE = (E_total[end] - E_total[1]) / E_total[1]
# Should be &lt; 10^-6 for inviscid runs</code></pre><p>See <a href="../../guide/diagnostics/#energy-diagnostics-output-files">Diagnostics Guide</a> for detailed usage.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Xie, J.-H., &amp; Vanneste, J. (2015). A generalised-Lagrangian-mean model of the interactions between near-inertial waves and mean flow. <em>J. Fluid Mech.</em>, 774, 143-169.</li><li>Wagner, G. L., &amp; Young, W. R. (2016). A three-component model for the coupled evolution of near-inertial waves, quasi-geostrophic flow and the near-inertial second harmonic. <em>J. Fluid Mech.</em>, 802, 806-837.</li><li>Asselin, O., &amp; Young, W. R. (2019). An improved model of near-inertial wave dynamics. <em>J. Fluid Mech.</em>, 876, 428-448.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ybj_plus/">« YBJ+ Wave Model</a><a class="docs-footer-nextpage" href="../numerical_methods/">Numerical Methods »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 20 January 2026 10:12">Tuesday 20 January 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
