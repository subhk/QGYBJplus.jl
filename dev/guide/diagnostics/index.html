<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Diagnostics · QGYBJ+.jl</title><meta name="title" content="Diagnostics · QGYBJ+.jl"/><meta property="og:title" content="Diagnostics · QGYBJ+.jl"/><meta property="twitter:title" content="Diagnostics · QGYBJ+.jl"/><meta name="description" content="Documentation for QGYBJ+.jl."/><meta property="og:description" content="Documentation for QGYBJ+.jl."/><meta property="twitter:description" content="Documentation for QGYBJ+.jl."/><meta property="og:url" content="https://subhk.github.io/QGYBJplus.jl/stable/guide/diagnostics/"/><meta property="twitter:url" content="https://subhk.github.io/QGYBJplus.jl/stable/guide/diagnostics/"/><link rel="canonical" href="https://subhk.github.io/QGYBJplus.jl/stable/guide/diagnostics/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">QGYBJ+.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../getting_started/">Installation</a></li><li><a class="tocitem" href="../../quickstart/">Quick Start</a></li><li><a class="tocitem" href="../../worked_example/">Worked Example</a></li></ul></li><li><span class="tocitem">Physics &amp; Theory</span><ul><li><a class="tocitem" href="../../physics/overview/">Model Overview</a></li><li><a class="tocitem" href="../../physics/qg_equations/">QG Equations</a></li><li><a class="tocitem" href="../../physics/ybj_plus/">YBJ+ Wave Model</a></li><li><a class="tocitem" href="../../physics/wave_mean/">Wave-Mean Interaction</a></li><li><a class="tocitem" href="../../physics/numerical_methods/">Numerical Methods</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../configuration/">Configuration</a></li><li><a class="tocitem" href="../stratification/">Stratification</a></li><li><a class="tocitem" href="../initial_conditions/">Initial Conditions</a></li><li><a class="tocitem" href="../simulation/">Running Simulations</a></li><li><a class="tocitem" href="../io/">I/O and Output</a></li><li class="is-active"><a class="tocitem" href>Diagnostics</a><ul class="internal"><li><a class="tocitem" href="#Energy-Diagnostics"><span>Energy Diagnostics</span></a></li><li><a class="tocitem" href="#Energy-Diagnostics-Output-Files"><span>Energy Diagnostics Output Files</span></a></li><li><a class="tocitem" href="#MPI-Aware-Energy-Functions"><span>MPI-Aware Energy Functions</span></a></li><li><a class="tocitem" href="#Wave-Diagnostics"><span>Wave Diagnostics</span></a></li><li><a class="tocitem" href="#Omega-Equation"><span>Omega Equation</span></a></li><li><a class="tocitem" href="#Time-Series-Analysis"><span>Time Series Analysis</span></a></li><li><a class="tocitem" href="#Diagnostic-Output-Example"><span>Diagnostic Output Example</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li></ul></li></ul></li><li><span class="tocitem">Advanced Topics</span><ul><li><a class="tocitem" href="../../advanced/parallel/">MPI Parallelization</a></li><li><a class="tocitem" href="../../advanced/particles/">Particle Advection</a></li><li><a class="tocitem" href="../../advanced/parallel_particles/">Parallel Particle Algorithm</a></li><li><a class="tocitem" href="../../advanced/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../advanced/performance/">Performance Tips</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/types/">Core Types</a></li><li><a class="tocitem" href="../../api/grid_state/">Grid &amp; State</a></li><li><a class="tocitem" href="../../api/physics/">Physics Functions</a></li><li><a class="tocitem" href="../../api/timestepping/">Time Stepping</a></li><li><a class="tocitem" href="../../api/particles/">Particles</a></li><li><a class="tocitem" href="../../api/">Full Index</a></li></ul></li><li><a class="tocitem" href="../../troubleshooting/">Troubleshooting</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Diagnostics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Diagnostics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/QGYBJplus.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/subhk/QGYBJplus.jl/blob/main/docs/src/guide/diagnostics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="diagnostics"><a class="docs-heading-anchor" href="#diagnostics">Diagnostics</a><a id="diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#diagnostics" title="Permalink"></a></h1><p>This page describes diagnostic quantities and analysis tools in QGYBJ+.jl.</p><h2 id="Energy-Diagnostics"><a class="docs-heading-anchor" href="#Energy-Diagnostics">Energy Diagnostics</a><a id="Energy-Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Diagnostics" title="Permalink"></a></h2><h3 id="Flow-Kinetic-Energy"><a class="docs-heading-anchor" href="#Flow-Kinetic-Energy">Flow Kinetic Energy</a><a id="Flow-Kinetic-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Flow-Kinetic-Energy" title="Permalink"></a></h3><p>The kinetic energy of the balanced flow:</p><p class="math-container">\[KE = \frac{1}{2}\int (u^2 + v^2) \, dV\]</p><pre><code class="language-julia hljs">KE = flow_kinetic_energy(state.u, state.v)</code></pre><h3 id="Flow-Potential-Energy-(Spectral)"><a class="docs-heading-anchor" href="#Flow-Potential-Energy-(Spectral)">Flow Potential Energy (Spectral)</a><a id="Flow-Potential-Energy-(Spectral)-1"></a><a class="docs-heading-anchor-permalink" href="#Flow-Potential-Energy-(Spectral)" title="Permalink"></a></h3><p>Available potential energy computed in spectral space with proper dealiasing:</p><p class="math-container">\[PE = \frac{1}{2}\int \frac{f_0^2}{N^2}\left(\frac{\partial\psi}{\partial z}\right)^2 dV\]</p><pre><code class="language-julia hljs"># Compute buoyancy field first (b = ∂ψ/∂z)
bk = similar(state.psi)
# ... compute vertical derivative ...
PE = flow_potential_energy_spectral(bk, grid, params)</code></pre><h3 id="Wave-Energy"><a class="docs-heading-anchor" href="#Wave-Energy">Wave Energy</a><a id="Wave-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Energy" title="Permalink"></a></h3><p>The wave kinetic energy is computed per YBJ+ equation (4.7):</p><p class="math-container">\[\text{WKE} = \frac{1}{2}\int |LA|^2 \, dV\]</p><p>where <span>$LA$</span> is computed directly using the L operator from equation (1.3):</p><p class="math-container">\[L = \partial_z \left( \frac{f^2}{N^2} \partial_z \right)\]</p><p>So <span>$LA = \partial_z(a(z) \times C)$</span> where <span>$a(z) = f^2/N^2$</span> and <span>$C = \partial A/\partial z$</span>.</p><pre><code class="language-julia hljs"># Detailed wave energy components
WKE, WPE, WCE = compute_detailed_wave_energy(state, grid, params)

# Simple wave kinetic energy
WE = compute_wave_energy(state, grid, plans; params=params)

# Vertically-averaged wave kinetic energy using LA = L⁺A + (k_h²/4)A
WE = wave_energy_vavg(state.L⁺A, state.A, grid, plans)</code></pre><div class="admonition is-info" id="Physical-interpretation-6ca715d2515936df"><header class="admonition-header">Physical interpretation<a class="admonition-anchor" href="#Physical-interpretation-6ca715d2515936df" title="Permalink"></a></header><div class="admonition-body"><p>WKE uses <span>$|LA|^2$</span> where LA is computed as <span>$LA = L^+A + (k_h^2/4)A$</span> in spectral space. This uses the original YBJ <span>$L$</span> operator (not <span>$L^+$</span>) for physical consistency.</p></div></div><h2 id="Energy-Diagnostics-Output-Files"><a class="docs-heading-anchor" href="#Energy-Diagnostics-Output-Files">Energy Diagnostics Output Files</a><a id="Energy-Diagnostics-Output-Files-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Diagnostics-Output-Files" title="Permalink"></a></h2><p>QGYBJ+.jl automatically saves energy diagnostics to separate files in a dedicated <code>diagnostic/</code> folder, following the structure used in the Fortran QG_YBJp code.</p><h3 id="Output-Folder-Structure"><a class="docs-heading-anchor" href="#Output-Folder-Structure">Output Folder Structure</a><a id="Output-Folder-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Output-Folder-Structure" title="Permalink"></a></h3><pre><code class="nohighlight hljs">output_dir/
├── state0001.nc              # Field snapshots
├── state0002.nc
├── diagnostics_0001.nc       # Legacy combined diagnostics
└── diagnostic/               # Separate energy files
    ├── wave_KE.nc            # Wave kinetic energy time series
    ├── wave_PE.nc            # Wave potential energy time series
    ├── wave_CE.nc            # Wave correction energy (YBJ+)
    ├── mean_flow_KE.nc       # Mean flow kinetic energy
    ├── mean_flow_PE.nc       # Mean flow potential energy
    └── total_energy.nc       # Summary file with all energies</code></pre><h3 id="Wave-Kinetic-Energy-(WKE)"><a class="docs-heading-anchor" href="#Wave-Kinetic-Energy-(WKE)">Wave Kinetic Energy (WKE)</a><a id="Wave-Kinetic-Energy-(WKE)-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Kinetic-Energy-(WKE)" title="Permalink"></a></h3><p>The wave kinetic energy is computed per YBJ+ equation (4.7):</p><p class="math-container">\[\text{WKE} = \frac{1}{2} \sum_{k_x, k_y, z} |LA|^2 - \text{(dealiasing correction)}\]</p><p>where <span>$LA = L^+A + (k_h^2/4)A$</span> in spectral space. This relationship comes from:</p><ul><li><span>$L^+A = LA - \frac{k_h^2}{4}A$</span> (definition of L⁺ operator)</li><li>In spectral space: <span>$\Delta \rightarrow -k_h^2$</span>, so <span>$L^+A = LA - (k_h^2/4)A$</span></li><li>Therefore: <span>$LA = L^+A + (k_h^2/4)A$</span></li></ul><p><strong>Physical interpretation</strong>: WKE represents the kinetic energy contained in the near-inertial wave field, computed from the wave velocity amplitude <span>$LA$</span> using the original YBJ <span>$L$</span> operator (not the evolved envelope <span>$L^+A$</span>). This ensures consistency with the energy budget in the YBJ+ formulation.</p><h3 id="Wave-Potential-Energy-(WPE)"><a class="docs-heading-anchor" href="#Wave-Potential-Energy-(WPE)">Wave Potential Energy (WPE)</a><a id="Wave-Potential-Energy-(WPE)-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Potential-Energy-(WPE)" title="Permalink"></a></h3><p>The wave potential energy captures vertical wave structure through <span>$C = \partial A/\partial z$</span>:</p><p class="math-container">\[\text{WPE} = \frac{1}{2} \sum_{k_x, k_y, z} \frac{k_h^2}{2 a_{ell}} \left( |C_R|^2 + |C_I|^2 \right)\]</p><p>where:</p><ul><li><span>$a_{ell} = f_0^2 / N^2$</span> is the elliptic coefficient</li><li><span>$C = \partial A / \partial z$</span> is the vertical derivative of wave amplitude</li><li><span>$k_h^2 = k_x^2 + k_y^2$</span> is the horizontal wavenumber squared</li></ul><p><strong>Physical interpretation</strong>: WPE represents the potential energy from wave-induced isopycnal displacements. It scales with <span>$N^2 \eta^2$</span> where <span>$\eta$</span> is the vertical displacement.</p><h3 id="Wave-Correction-Energy-(WCE)"><a class="docs-heading-anchor" href="#Wave-Correction-Energy-(WCE)">Wave Correction Energy (WCE)</a><a id="Wave-Correction-Energy-(WCE)-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Correction-Energy-(WCE)" title="Permalink"></a></h3><p>The YBJ+ formulation includes a higher-order correction term:</p><p class="math-container">\[\text{WCE} = \frac{1}{2} \sum_{k_x, k_y, z} \frac{k_h^4}{8 a_{ell}^2} \left( |A_R|^2 + |A_I|^2 \right)\]</p><p><strong>Physical interpretation</strong>: WCE is a higher-order correction from the YBJ+ equation that accounts for horizontal wave dispersion. It becomes important for short horizontal wavelengths.</p><h3 id="Mean-Flow-Kinetic-Energy"><a class="docs-heading-anchor" href="#Mean-Flow-Kinetic-Energy">Mean Flow Kinetic Energy</a><a id="Mean-Flow-Kinetic-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Mean-Flow-Kinetic-Energy" title="Permalink"></a></h3><p>The balanced flow kinetic energy is computed from the geostrophic velocities:</p><p class="math-container">\[\text{KE}_{flow} = \frac{1}{2} \sum_{k_x, k_y, z} \left( |u_k|^2 + |v_k|^2 \right) - \frac{1}{2} |u(k_h=0)|^2\]</p><p>where the velocities are derived from the streamfunction:</p><p class="math-container">\[u = -\frac{\partial \psi}{\partial y} = -ik_y \hat{\psi}, \quad v = \frac{\partial \psi}{\partial x} = ik_x \hat{\psi}\]</p><p>This gives:</p><p class="math-container">\[|u|^2 + |v|^2 = k_h^2 |\hat{\psi}|^2\]</p><p><strong>Physical interpretation</strong>: <span>$\text{KE}_{flow}$</span> represents the kinetic energy of the large-scale quasi-geostrophic eddies and jets.</p><h3 id="Mean-Flow-Potential-Energy"><a class="docs-heading-anchor" href="#Mean-Flow-Potential-Energy">Mean Flow Potential Energy</a><a id="Mean-Flow-Potential-Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Mean-Flow-Potential-Energy" title="Permalink"></a></h3><p>The available potential energy from buoyancy:</p><p class="math-container">\[\text{PE}_{flow} = \frac{1}{2} \sum_{k_x, k_y, z} \frac{f_0^2}{N^2} |b_k|^2\]</p><p>where buoyancy <span>$b$</span> is related to the streamfunction via thermal wind balance:</p><p class="math-container">\[b = \frac{\partial \psi}{\partial z}\]</p><p><strong>Physical interpretation</strong>: <span>$\text{PE}_{flow}$</span> represents the energy stored in tilted isopycnals (density surfaces). It can be released through baroclinic instability.</p><h3 id="Total-Energy-Conservation"><a class="docs-heading-anchor" href="#Total-Energy-Conservation">Total Energy Conservation</a><a id="Total-Energy-Conservation-1"></a><a class="docs-heading-anchor-permalink" href="#Total-Energy-Conservation" title="Permalink"></a></h3><p>In the inviscid limit, the total energy is conserved:</p><p class="math-container">\[E_{total} = \underbrace{\text{KE}_{flow} + \text{PE}_{flow}}_{\text{Mean flow}} + \underbrace{\text{WKE} + \text{WPE} + \text{WCE}}_{\text{Waves}} = \text{const}\]</p><p>Energy exchange between waves and mean flow occurs via:</p><ul><li><strong>Refraction</strong>: Waves gain/lose energy from vorticity gradients</li><li><strong>Wave feedback</strong> <span>$q^w$</span>: Waves modify the effective PV</li></ul><h3 id="Using-the-EnergyDiagnosticsManager"><a class="docs-heading-anchor" href="#Using-the-EnergyDiagnosticsManager">Using the EnergyDiagnosticsManager</a><a id="Using-the-EnergyDiagnosticsManager-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-EnergyDiagnosticsManager" title="Permalink"></a></h3><p>The energy diagnostics manager is automatically created during simulation setup:</p><pre><code class="language-julia hljs"># Energy diagnostics are computed and saved automatically during simulation
sim = setup_simulation(config)
run_simulation!(sim)

# After simulation, files are in:
# output_dir/diagnostic/wave_KE.nc
# output_dir/diagnostic/wave_PE.nc
# etc.</code></pre><p>For manual control:</p><pre><code class="language-julia hljs">using QGYBJplus

# Create manager manually
energy_manager = EnergyDiagnosticsManager(
    &quot;output_dir&quot;;
    output_interval=1.0  # Time between outputs
)

# Record energies at each diagnostic time
record_energies!(
    energy_manager,
    current_time,
    wave_KE, wave_PE, wave_CE,
    mean_flow_KE, mean_flow_PE
)

# Write all files at end
write_all_energy_files!(energy_manager)</code></pre><h3 id="Reading-Energy-Output-Files"><a class="docs-heading-anchor" href="#Reading-Energy-Output-Files">Reading Energy Output Files</a><a id="Reading-Energy-Output-Files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-Energy-Output-Files" title="Permalink"></a></h3><pre><code class="language-julia hljs">using NCDatasets

# Read wave KE time series
ds = NCDataset(&quot;output_dir/diagnostic/wave_KE.nc&quot;, &quot;r&quot;)
time = ds[&quot;time&quot;][:]
wave_KE = ds[&quot;wave_KE&quot;][:]
close(ds)

# Read total energy summary
ds = NCDataset(&quot;output_dir/diagnostic/total_energy.nc&quot;, &quot;r&quot;)
time = ds[&quot;time&quot;][:]
total_wave = ds[&quot;total_wave_energy&quot;][:]
total_flow = ds[&quot;total_flow_energy&quot;][:]
total = ds[&quot;total_energy&quot;][:]
close(ds)

# Plot energy evolution
using Plots
plot(time, total, label=&quot;Total&quot;, linewidth=2)
plot!(time, total_flow, label=&quot;Mean flow&quot;, linestyle=:dash)
plot!(time, total_wave, label=&quot;Waves&quot;, linestyle=:dot)
xlabel!(&quot;Time&quot;)
ylabel!(&quot;Energy&quot;)</code></pre><h3 id="Energy-Budget-Verification"><a class="docs-heading-anchor" href="#Energy-Budget-Verification">Energy Budget Verification</a><a id="Energy-Budget-Verification-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Budget-Verification" title="Permalink"></a></h3><p>Check energy conservation:</p><pre><code class="language-julia hljs"># After simulation
ds = NCDataset(&quot;output_dir/diagnostic/total_energy.nc&quot;, &quot;r&quot;)
E = ds[&quot;total_energy&quot;][:]
close(ds)

# Relative change
dE_rel = (E[end] - E[1]) / E[1]
println(&quot;Relative energy change: $(dE_rel)&quot;)

if abs(dE_rel) &lt; 1e-6
    println(&quot;Energy well conserved&quot;)
else
    println(&quot;Check time step or dissipation settings&quot;)
end</code></pre><h2 id="MPI-Aware-Energy-Functions"><a class="docs-heading-anchor" href="#MPI-Aware-Energy-Functions">MPI-Aware Energy Functions</a><a id="MPI-Aware-Energy-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#MPI-Aware-Energy-Functions" title="Permalink"></a></h2><p>For parallel simulations, use the global reduction versions:</p><pre><code class="language-julia hljs"># Physical-space energy with MPI reduction
KE = flow_kinetic_energy_global(state.u, state.v, mpi_config)
WE_B, WE_A = wave_energy_global(state.L⁺A, state.A, mpi_config)

# Spectral energy with MPI reduction
KE_spectral = flow_kinetic_energy_spectral_global(uk, vk, grid, params; mpi_config=mpi_config)
PE_spectral = flow_potential_energy_spectral_global(bk, grid, params; mpi_config=mpi_config)
WKE, WPE, WCE = wave_energy_spectral_global(BR, BI, AR, AI, CR, CI, grid, params; mpi_config=mpi_config)</code></pre><h2 id="Wave-Diagnostics"><a class="docs-heading-anchor" href="#Wave-Diagnostics">Wave Diagnostics</a><a id="Wave-Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Diagnostics" title="Permalink"></a></h2><h3 id="Wave-Amplitude"><a class="docs-heading-anchor" href="#Wave-Amplitude">Wave Amplitude</a><a id="Wave-Amplitude-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Amplitude" title="Permalink"></a></h3><pre><code class="language-julia hljs"># |A|² field
A2 = abs2.(state.A)

# Maximum amplitude
A_max = maximum(sqrt.(A2))

# Volume-averaged amplitude
using Statistics
A_rms = sqrt(mean(A2))</code></pre><h3 id="Wave-Velocities"><a class="docs-heading-anchor" href="#Wave-Velocities">Wave Velocities</a><a id="Wave-Velocities-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-Velocities" title="Permalink"></a></h3><p>Compute wave-induced velocities (in-place):</p><pre><code class="language-julia hljs"># Updates state.u, state.v with wave velocities
compute_wave_velocities!(state, grid; plans=plans, params=params, compute_w=true)</code></pre><h2 id="Omega-Equation"><a class="docs-heading-anchor" href="#Omega-Equation">Omega Equation</a><a id="Omega-Equation-1"></a><a class="docs-heading-anchor-permalink" href="#Omega-Equation" title="Permalink"></a></h2><p>The omega equation computes ageostrophic vertical velocity:</p><p class="math-container">\[\nabla^2 w + \frac{f_0^2}{N^2}\frac{\partial^2 w}{\partial z^2} = \frac{2f_0}{N^2}J\left(\frac{\partial\psi}{\partial z}, \nabla^2\psi\right)\]</p><p>Use <code>omega_eqn_rhs!</code> to compute the right-hand side:</p><pre><code class="language-julia hljs"># Compute omega equation RHS
omega_eqn_rhs!(rhs, state.psi, grid, params, plans)</code></pre><h2 id="Time-Series-Analysis"><a class="docs-heading-anchor" href="#Time-Series-Analysis">Time Series Analysis</a><a id="Time-Series-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Series-Analysis" title="Permalink"></a></h2><h3 id="Recording-Diagnostics-Manually"><a class="docs-heading-anchor" href="#Recording-Diagnostics-Manually">Recording Diagnostics Manually</a><a id="Recording-Diagnostics-Manually-1"></a><a class="docs-heading-anchor-permalink" href="#Recording-Diagnostics-Manually" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Initialize storage arrays
time_series = Float64[]
KE_series = Float64[]
WKE_series = Float64[]

for step = 1:nsteps
    # ... time stepping code ...

    # Record diagnostics
    push!(time_series, step * dt)
    push!(KE_series, flow_kinetic_energy(state.u, state.v))
    WKE, WPE, WCE = compute_detailed_wave_energy(state, grid, params)
    push!(WKE_series, WKE)
end</code></pre><h3 id="Energy-Conservation-Check"><a class="docs-heading-anchor" href="#Energy-Conservation-Check">Energy Conservation Check</a><a id="Energy-Conservation-Check-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Conservation-Check" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Total energy should be conserved (inviscid)
E_total = KE_series .+ WKE_series

# Check conservation
dE = (E_total[end] - E_total[1]) / E_total[1]
println(&quot;Relative energy change: $dE&quot;)

if abs(dE) &gt; 1e-6
    @warn &quot;Energy not well conserved!&quot;
end</code></pre><h2 id="Diagnostic-Output-Example"><a class="docs-heading-anchor" href="#Diagnostic-Output-Example">Diagnostic Output Example</a><a id="Diagnostic-Output-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostic-Output-Example" title="Permalink"></a></h2><pre><code class="language-julia hljs">function compute_diagnostics(state, grid, params)
    diag = Dict{String, Any}()

    # Energy
    diag[&quot;KE&quot;] = flow_kinetic_energy(state.u, state.v)
    diag[&quot;WKE&quot;], diag[&quot;WPE&quot;], diag[&quot;WCE&quot;] = compute_detailed_wave_energy(state, grid, params)
    diag[&quot;WE_B&quot;], diag[&quot;WE_A&quot;] = wave_energy(state.L⁺A, state.A)

    # Extrema
    diag[&quot;A_max&quot;] = maximum(abs.(state.A))
    diag[&quot;psi_max&quot;] = maximum(abs.(state.psi))

    return diag
end

function print_diagnostics(diag, step, time)
    println(&quot;=&quot; ^ 60)
    println(&quot;Step: $step, Time: $(round(time, digits=4))&quot;)
    println(&quot;-&quot; ^ 60)
    println(&quot;  KE = $(round(diag[&quot;KE&quot;], sigdigits=6))&quot;)
    println(&quot;  WKE = $(round(diag[&quot;WKE&quot;], sigdigits=6))&quot;)
    println(&quot;  |A|_max = $(round(diag[&quot;A_max&quot;], sigdigits=4))&quot;)
    println(&quot;=&quot; ^ 60)
end</code></pre><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><p>See the <a href="../../api/physics/">Physics API Reference</a> for complete documentation of diagnostic functions:</p><ul><li><code>flow_kinetic_energy</code> - Mean flow kinetic energy</li><li><code>flow_kinetic_energy_spectral</code> - Spectral kinetic energy with dealiasing</li><li><code>flow_potential_energy_spectral</code> - Spectral potential energy</li><li><code>wave_energy</code> - Basic wave energy from B and A fields</li><li><code>wave_energy_spectral</code> - Spectral wave energy components</li><li><code>compute_detailed_wave_energy</code> - Detailed WKE, WPE, WCE computation</li><li><code>compute_wave_energy</code> - Simple wave energy computation</li><li><code>flow_kinetic_energy_global</code> / <code>wave_energy_global</code> - MPI-aware global reductions</li><li><code>omega_eqn_rhs!</code> - Omega equation RHS computation</li><li><code>EnergyDiagnosticsManager</code> - Automatic energy output to separate files</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../io/">« I/O and Output</a><a class="docs-footer-nextpage" href="../../advanced/parallel/">MPI Parallelization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 23 January 2026 14:19">Friday 23 January 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
